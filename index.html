<!DOCTYPE html>
<html lang=en-us>
<head>
<meta charset=utf-8><meta content="text/html; charset=utf-8" http-equiv=Content-Type>
<title>OCCT Draw Harness</title>
</head>
<body>

  <canvas id=occViewerCanvas oncontextmenu=event.preventDefault() tabindex=-1 style="border:0 none;background-color:#000" width="409" height="409"></canvas>

  <hr>
  <textarea id="commandRoRun">pload all</textarea>
  <button id="runCommand">run</button>
  <hr>
  <textarea id="commandExecutionResults"></textarea>
  <hr>
  

<script>
  let wasmModule;
  async function loadWasmModule() {
    try {
      const response = await fetch('wasm32-pthread/DRAWEXE.wasm');
      const buffer = await response.arrayBuffer();
      const module = await WebAssembly.compile(buffer);
      const imports = {
        env: {
          memory: new WebAssembly.Memory({ initial: 256, maximum: 256 }),
          table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' }),
          abort: () => console.log('Abort!'),
          _emscripten_memcpy_big: (dest, src, num) => {
            const destView = new Uint8Array(wasmModule.memory.buffer, dest, num);
            const srcView = new Uint8Array(wasmModule.memory.buffer, src, num);
            destView.set(srcView);
          }
        }
      };
      const instance = await WebAssembly.instantiate(module, imports);
      wasmModule = instance.exports;
    } catch (error) {
      console.error('Error loading WebAssembly module:', error);
    }
  }

  document.getElementById('runCommand').addEventListener('click', async () => {
    if (!wasmModule) {
      await loadWasmModule();
    }
    if (wasmModule && wasmModule.executeCommand) {
      const command = document.getElementById('commandRoRun').value;
      const result = wasmModule.executeCommand(command);
      document.getElementById('commandExecutionResults').value = result;
    } else {
      console.error('WebAssembly module is not properly initialized.');
    }
  });
</script>

</body>
</html>
